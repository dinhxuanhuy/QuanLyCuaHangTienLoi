using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace QuanLyCuaHangTienLoi
{
    public partial class UCChatBox : UserControl
    {
        // Event ?? ?i?u h??ng v? các UC khác n?u c?n
        public event Action<UserControl> NavigateRequest;

        public UCChatBox()
        {
            InitializeComponent();
        }

        private void UCChatBox_Load(object sender, EventArgs e)
        {
            // Scroll xu?ng cu?i khi load
            flowPanelMessages.AutoScroll = true;
        }

        private void btn_guiTinNhan_Click(object sender, EventArgs e)
        {
            GuiTinNhan();
        }

        private void txt_nhapTinNhan_KeyDown(object sender, KeyEventArgs e)
        {
            // Nh?n Enter ?? g?i tin nh?n
            if (e.KeyCode == Keys.Enter && !e.Shift)
            {
                e.SuppressKeyPress = true;
                GuiTinNhan();
            }
        }

        private void GuiTinNhan()
        {
            string tinNhan = txt_nhapTinNhan.Text.Trim();
            if (string.IsNullOrEmpty(tinNhan))
                return;

            // Thêm tin nh?n c?a ng??i dùng
            ThemTinNhan(tinNhan, true);

            // Xóa textbox
            txt_nhapTinNhan.Text = "";

            // Gi? l?p ph?n h?i t? bot (có th? thay ??i sau)
            string phanHoi = XuLyTinNhan(tinNhan);
            ThemTinNhan(phanHoi, false);
        }

        private void ThemTinNhan(string noiDung, bool laNguoiDung)
        {
            // T?o panel ch?a tin nh?n
            Panel pnlMessage = new Panel();
            pnlMessage.AutoSize = true;
            pnlMessage.MaximumSize = new Size(flowPanelMessages.Width - 100, 0);
            pnlMessage.Padding = new Padding(10);

            // T?o label hi?n th? tin nh?n
            Label lblMessage = new Label();
            lblMessage.Text = noiDung;
            lblMessage.AutoSize = true;
            lblMessage.MaximumSize = new Size(flowPanelMessages.Width - 120, 0);
            lblMessage.Font = new Font("Segoe UI", 10F);
            lblMessage.Padding = new Padding(8);

            if (laNguoiDung)
            {
                // Tin nh?n ng??i dùng - màu xanh, c?n ph?i
                lblMessage.BackColor = Color.FromArgb(0, 120, 215);
                lblMessage.ForeColor = Color.White;
                pnlMessage.Dock = DockStyle.Right;
            }
            else
            {
                // Tin nh?n bot - màu xám, c?n trái
                lblMessage.BackColor = Color.FromArgb(230, 230, 230);
                lblMessage.ForeColor = Color.Black;
                pnlMessage.Dock = DockStyle.Left;
            }

            pnlMessage.Controls.Add(lblMessage);

            // Thêm vào flow panel
            flowPanelMessages.Controls.Add(pnlMessage);

            // Scroll xu?ng cu?i
            flowPanelMessages.ScrollControlIntoView(pnlMessage);
        }

        private string XuLyTinNhan(string tinNhan)
        {
            // Logic x? lý tin nh?n c? b?n - có th? m? r?ng sau
            tinNhan = tinNhan.ToLower();

            if (tinNhan.Contains("xin chào") || tinNhan.Contains("hello") || tinNhan.Contains("hi"))
            {
                return "Xin chào! Tôi có th? giúp gì cho b?n?";
            }
            else if (tinNhan.Contains("giá") || tinNhan.Contains("s?n ph?m"))
            {
                return "B?n có th? xem giá s?n ph?m trong m?c Qu?n lý d? li?u > S?n ph?m.";
            }
            else if (tinNhan.Contains("hóa ??n"))
            {
                return "?? t?o hóa ??n m?i, vui lòng vào m?c Qu?n lý hóa ??n.";
            }
            else if (tinNhan.Contains("th?ng kê") || tinNhan.Contains("doanh thu"))
            {
                return "B?n có th? xem th?ng kê doanh thu trong m?c Th?ng kê.";
            }
            else if (tinNhan.Contains("ca làm") || tinNhan.Contains("ca làm vi?c"))
            {
                return "Thông tin ca làm vi?c có trong m?c Qu?n lý ca.";
            }
            else if (tinNhan.Contains("c?m ?n") || tinNhan.Contains("thank"))
            {
                return "Không có gì! N?u c?n h? tr? thêm, hãy h?i tôi nhé!";
            }
            else
            {
                return "Tôi ch?a hi?u câu h?i c?a b?n. B?n có th? h?i v?: s?n ph?m, hóa ??n, th?ng kê, ca làm vi?c...";
            }
        }
    }
}
